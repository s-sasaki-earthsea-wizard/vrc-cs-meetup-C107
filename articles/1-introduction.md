# Discord Botに個性を持たせる - RAGによるパーソナライズされたAI VTuber配信の実装

## 1. はじめに

最近、ChatGPTやClaude、Geminiなど、大規模言語モデル（LLM）の進化が目覚ましいですよね。これらを使ったチャットボットやAI VTuberも次々と登場しています。

[Neuro-sama](https://www.twitch.tv/vedal987)のようにゲームプレイ配信で個性的なキャラクターを演じるAI VTuberや、プロンプトエンジニアリングを駆使したAI VTuberの実装も数多く生まれています（参考：[『AITuberを作ってみたらプロンプトエンジニアリングがよくわかった件』](https://bookplus.nikkei.com/atcl/catalog/24/11/07/01683/)）。

また、AI VTuberの個性を豊かにする技術として**RAG（Retrieval-Augmented Generation、検索拡張生成）**も既に多くのプロジェクトで活用されています。RAGは、データベースから関連情報を検索してLLMのプロンプトに注入することで、より文脈に沿った応答を生成できる技術です。上記の書籍でもRAGについて詳しく解説されていますし、本プロジェクトのフォーク元である[AIRI](https://github.com/moeru-ai/airi)でも既にRAGが実装されています。

では、本記事で何を紹介するのか？

本記事のユニークな点は、**Discordサーバーのユーザーの発言履歴をナレッジDBとして活用し、「その人っぽさ」を反映したAI VTuber配信を実現した**ことです。

具体的には、私自身が書き込んでいるDiscordサーバーの発言履歴（「宝塚が好き」「ポケモンのダブルバトルが好き」「月村了衛先生の小説が好き」など）をデータベースに登録し、YouTube Live配信で視聴者から質問があったときに、RAGで関連する過去発言を検索して応答に反映させています。

例えば、「レ・ミゼラブルは好きですか？」と聞かれたとき、データベースには「レ・ミゼラブル」の記録はないけれど、「舞台」というキーワードから「宝塚歌劇が好き」という過去発言を引っ張ってきて、自然に話を展開できる。つまり、**プロンプトに書ききれない膨大な趣味嗜好を、ナレッジDBとRAGで実現する**のが本記事のテーマです。

### 1.1 本記事の目的

この記事で紹介するのは、以下の3つです：

1. **AI VTuberとRAGを組み合わせたパーソナライズシステム**
   - Discordサーバーの発言履歴をデータベース化
   - RAGでユーザーの過去発言を検索して、個性ある応答を生成

2. **従来のプロンプトエンジニアリングだけでは実現できない「個性」の実装**
   - プロンプトだけでは数千トークンの制限内で表現できる範囲に限界がある
   - データベース + RAGなら、実質無制限の話題と個性を扱える

3. **オープンソースプロジェクトとして、誰でも試せる実装例**
   - GitHub: [airi-youtube-live](https://github.com/s-sasaki-earthsea-wizard/airi-youtube-live)
   - MIT Licenseで公開中
   - セットアップから運用まで詳しく解説

### 1.2 プロジェクトの背景

このプロジェクトは、[AIRI](https://github.com/moeru-ai/airi)というオープンソースプロジェクトをベースにしています。AIRIはDiscordやTelegram、あるいはブラウザで3Dアバターとのボイスチャットを楽しむプロジェクトで、**既にRAGによるナレッジDB検索機能が実装されていました**。

本プロジェクトでの主な貢献は以下の3点です：

1. **YouTube Live配信への対応**
   - YouTube Data API v3を使ったコメント取得機能の実装
   - ライブ配信でのリアルタイム応答システムの構築

2. **Discordサーバーの発言をナレッジDBに登録**
   - AIRIの既存ナレッジDBスキーマをそのまま流用
   - 私自身が参加しているDiscordサーバーの発言履歴を登録
   - その結果、「私っぽい」趣味嗜好を反映したAI VTuberが実現

3. **RAG検索の工夫と最適化**
   - ナレッジDB自体はAIRIに実装済み
   - しかし、適切なレコードを検索する方法（ユーザー別検索、類似度閾値調整、カテゴリフィルタ等）は試行錯誤が必要
   - 現在も最適な検索方法を模索中（詳細は第5章で解説）

つまり、**RAG自体は既存機能だが、YouTube Live配信への適用、個人のDiscordデータによる「その人っぽさ」の実現、そして検索方法の最適化**が本プロジェクトの特徴です。

開発期間は約1ヶ月（2024年10月から開発開始）。現在も開発途上で、月1回の配信を目標に機能追加を続けています。

---

